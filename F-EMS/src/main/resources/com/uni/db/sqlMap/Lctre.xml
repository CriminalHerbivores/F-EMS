<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<!--  [[개정이력(Modification Information)]]        -->
<!--  수정일       수정자      수정내용             -->
<!--  ==========   ======    ==============         -->
<!--  $2017.01.24    KJH       최초작성             -->
<!--  $2017.02.15    KJH       추가작성             -->
<!--  $2017.02.25    KJH       추가작성             -->
<!--  Copyright (c) 2017 by DDIT All right reserved -->
    
<sqlMap namespace="Lctre">
	<typeAlias alias="str" type="java.lang.String" />
	<typeAlias alias="int" type="java.lang.Integer" />
	<typeAlias alias="lctre" type="com.uni.fems.dto.LctreVO" />
	<typeAlias alias="searchvo" type="com.uni.fems.dto.SearchVO" />
	<typeAlias alias="lctre_Search" type="com.uni.fems.dto.Lctre_SearchVO" />
	 
		
	<!-- 한개 강의 가져오기 -->
	<!-- <select id="getLctre" parameterClass="lctre_Search" resultClass="lctre_Search">
		select * from lctre_view 
		where lc_Lctre_No=#lc_Lctre_No# 
	</select>-->
		
		<!-- 개설된 강의의 갯수 -->
	<select id="totalOpenLctre" parameterClass="searchvo" resultClass="int">
		select count(*) from lctre_view where $key$ like '%'||#value#||'%'
		and lu_Compl_Se like '%'||#lu_Compl_Se#||'%' and knd_Lctre_Knd like '%'||#knd_Lctre_Knd#||'%'
		and lc_Open_At='y'
		and lc_Lctrbgn_Dt between (select add_months(sysdate,-4) from dual) and (select add_months(sysdate,1) from dual)
		order by lu_Lctre_code asc, lc_split asc
	</select>
	
	<!-- 개설 학기의 전체 강의 목록 -->
	<select id="openLctreList" parameterClass="searchvo" resultClass="lctre_Search">
		select lc_Lctre_No, sit_Subjct,lu_Lctre_Code,lc_Split,lu_Grade,lu_Lctre_Nm,lu_Compl_Se,knd_Lctre_Knd ,pr_Nm,lu_Pnt,lc_Lctre_Time,lc_Lctre_Nmpr,lr_Accept_Nmpr
   		from LCTRE_VIEW 
   		where lu_Compl_Se like '%'||#lu_Compl_Se#||'%' and knd_Lctre_Knd like '%'||#knd_Lctre_Knd#||'%'
		and lc_Open_At='y'
		and lc_Lctrbgn_Dt between (select add_months(sysdate,-4) from dual) and (select add_months(sysdate,1) from dual)
		intersect
   		select lc_Lctre_No, sit_Subjct,lu_Lctre_Code,lc_Split,lu_Grade,lu_Lctre_Nm,lu_Compl_Se,knd_Lctre_Knd ,pr_Nm,lu_Pnt,lc_Lctre_Time,lc_Lctre_Nmpr,lr_Accept_Nmpr 
    	from lctre_view 
    	where $key$ like '%'||#value#||'%'
		and lc_Open_At='y'
		and lc_Lctrbgn_Dt between (select add_months(sysdate,-4) from dual) and (select add_months(sysdate,1) from dual)
    	order by lu_Lctre_code asc, lc_split asc
	</select>
	
	<!-- 강의번호중 가장 큰 값 가져온다 -->
	<select id="selectMaxLc_Lctre_No" parameterClass="int">
		select max(lc_Lctre_No) from lctre
	</select>
	
	<!-- 강의 등록 -->
	<update id="insertLctre" parameterClass="lctre">
	<dynamic>
	<isNotEmpty property="lc_Lctre_No">
		INSERT INTO LCTRE(lc_Lctre_No,lc_Lctre_Code,lc_Profsr_No,lc_Wik_Lctre_Dayweek,lc_Lctre_Time)
			VALUES(ltr_seq.nextval,#lc_Lctre_Code#,#lc_Profsr_No#,#lc_Wik_Lctre_Dayweek#,#lc_Lctre_Time#)
	</isNotEmpty>
	</dynamic>
	</update>
	
	<!-- 강의 상세조회(강의계획서) -->
	<select id="getDetailLctre" parameterClass="int" resultClass="lctre_Search">
		select * from LCTRE_VIEW where lc_Lctre_No=#lc_Lctre_No#
	</select>
	
	
	<!-- 강의 수정 -->
	<update id="updateLctre" parameterClass="lctre">
		update lctre set lc_Profsr_No=#lc_Profsr_No#,lc_Lctrbgn_Dt=#lc_Lctrbgn_Dt#,lc_Lctre_Nmpr=#lc_Lctre_Nmpr#,lc_Wik_Lctre_Dayweek=#lc_Wik_Lctre_Dayweek#,lc_Lctre_Time=#lc_Lctre_Time#,lc_Lctrum_No=#lc_Lctrum_No#,lc_Open_At=#lc_Open_At#,lc_Lctre_Org=#lc_Lctre_Org#,lc_Lctre_Evl_Score=#lc_Lctre_Evl_Score#,lc_Split=#lc_Split#
		where lc_Lctre_No=#lc_Lctre_No#
	</update>
	
	<!-- 강의 삭제 -->
	<!-- <update id="deleteLctre" parameterClass="int">
		delete from lctre where lc_Lctre_No=#lc_Lctre_No#
	</update> -->
	
	<!-- 강의계획서 조회 -->
	<select id="" parameterClass="int">
		select * from Lctre_View where lc_Lctre_No=#lc_Lctre_No#
	</select>
	
	<!-- 강의 검색 :: 교수 검색과 개설 여부 -->
	<select id="selectLctre" parameterClass="lctre_Search" resultClass="lctre_Search">
		select * from lctre_View
		where la_Lctre_No like '%%'
		<isNotNull prepend="and" property="pr_Profsr_No">
		pr_profsr_no like '%'||#pr_Profsr_No#||'%'
		</isNotNull>
		<isNotNull prepend="and" property="lc_Open_At">
		lc_Open_At like '%'||#lc_Open_At#||'%'
		</isNotNull>
		<isLessThan prepend="and" property="lc_Lctre_Evl_Score" compareValue="0">
		LC_LCTRE_EVL_SCORE = 0
		</isLessThan>
		<isNotNull prepend="and" property="lc_Period">
		extract(year from(lc_Lctrbgn_Dt)) like '%'||#lc_Period#||'%'
		</isNotNull>
		<isNotNull prepend="and" property="lc_Term">
		lc_Term like #lc_Term#
		</isNotNull>
	</select>
	
	<!-- 강의 검색 개수 :: 교수 검색과 개설 여부 -->
	<select id="countLctre" parameterClass="lctre_Search" resultClass="int">
		select count(*) from lctre_View
		where la_Lctre_No like '%%'
		<isNotNull prepend="and" property="pr_Profsr_No">
		pr_profsr_no like '%'||#pr_Profsr_No#||'%'
		</isNotNull>
		<isNotNull prepend="and" property="lc_Open_At">
		lc_Open_At like '%'||#lc_Open_At#||'%'
		</isNotNull>
		<isLessThan prepend="and" property="lc_Lctre_Evl_Score" compareValue="0">
		LC_LCTRE_EVL_SCORE = 0
		</isLessThan>
		<isNotNull prepend="and" property="lc_Period">
		extract(year from(lc_Lctrbgn_Dt)) like '%'||#lc_Period#||'%'
		</isNotNull>
		<isNotNull prepend="and" property="lc_Term">
		lc_Term like #lc_Term#
		</isNotNull>
	</select>
</sqlMap>