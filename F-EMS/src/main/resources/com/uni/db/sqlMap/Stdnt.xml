<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<!--  [[개정이력(Modification Information)]]       -->
<!--  수정일              수정자        수정내용               -->
<!--  ==========   ======    ==============        -->
<!--  2017.01.24.   JAR      최초작성               -->
<!--  2017.02.15.   JAR      추가작성               -->
<!--  2017.03.07.   KJS      추가작성               -->
<!--  Copyright (c) 2017 by DDIT All right reserved -->

<sqlMap namespace="Stdnt">
	<typeAlias alias="str" type="java.lang.String" />
	<typeAlias alias="int" type="java.lang.Integer" />
	<typeAlias alias = "stdnt" type="com.uni.fems.dto.StdntVO" />

	<!-- 학생 개수 등록 -->
	<select id="totalStdnt" parameterClass="str" resultClass="int">
		select count(*) from stdnt where st_stdnt_no like '%$st_Stdnt_No$%'
	</select>
	
	<!-- 학생 페이지로 출력 -->
	<select id="selectAllStdntPage" parameterClass="str" resultClass="stdnt">
		select * from stdnt where st_nm like '%$st_nm$%'
	</select>
	
	<!-- 학생 한명 출력 -->
	<select id="selectStdnt" parameterClass="str" resultClass="stdnt">
		select * from stdnt_view where st_Stdnt_No = #st_Stdnt_No#
	</select>
	
	<!-- 학생 페이지로 출력 -->
<!-- 	<select id="selectNameStdntPage" parameterClass="str" resultClass="stdnt">
		select * from stdnt where st_nm like '%$st_nm$%'
		<isNotEqual prepend="st_Stdnt_No"></isNotEqual>
		<isNotEqual prepend="st_Subjct_Code"></isNotEqual>
		<isNotEqual prepend="st_Nm"></isNotEqual>
		<isNotEqual prepend="st_Ihidnum"></isNotEqual>
	</select> -->
	
	<!--학생 등록시 No 만들기 위해  -->	
<select id="createStdntNo" parameterClass="stdnt" resultClass="str">
	select '1'||trim(to_char((select substr(max(to_number(st_Stdnt_No))+1,-3) from stdnt where st_Stdnt_No like #createNo#||'%'), '000')) from dual
	</select>


	<update id="insertStdnt" parameterClass="stdnt">
	insert into stdnt(
	st_stdnt_no,
	st_subjct_code,
	st_pw,
	st_nm,
	st_eng_nm,
	st_ihidnum,
	st_moblphon_no,
	st_house_tlphon_no,
	st_entsch_dt,
	st_prtctor_nm,
	st_family_relate,
	st_post_no,
	st_adres1,
	st_adres2,
	st_cnslt_at,
	st_email,
	st_brhs_at,
	st_profsr_no,
	st_grdtn_dt)
	values
	(
	#st_Stdnt_No#,
	#st_Subjct_Code#,
	#st_Pw#,
	#st_Nm#,
	#st_Eng_Nm#,
	#st_Ihidnum#,
	#st_Moblphon_No#,
	#st_House_Tlphon_No#,
	#st_Entsch_Dt#,
	#st_Prtctor_Nm#,
	#st_Family_Relate#,
	#st_Post_No#,
	#st_Adres1#,
	#st_Adres2#,
	#st_Cnslt_At#,
	#st_Email#,
	#st_Brhs_At#,
	#st_Profsr_No#,
	#st_Grdtn_Dt#) 
	</update>
	
	<update id="updateStdnt" parameterClass="stdnt">
	update stdnt set 
	<!-- st_subjct_code = #st_Subjct_Code#, -->
	st_pw = #st_Pw#,
	st_nm = #st_Nm#,
	st_eng_nm = #st_Eng_Nm#,
	<!-- st_ihidnum = #st_Ihidnum#, -->
	st_moblphon_no = #st_Moblphon_No#,
	st_house_tlphon_no = #st_House_Tlphon_No#,
	<!-- st_entsch_dt = #st_Entsch_Dt#, -->
	st_prtctor_nm = #st_Prtctor_Nm#,
	st_family_relate = #st_Family_Relate#,
	st_post_no = #st_Post_No#,
	st_adres1 = #st_Adres1#,
	st_adres2 = #st_Adres2#,
	<!-- st_cnslt_at = #st_Cnslt_At#, -->
	st_email = #st_Email#
	<!-- st_brhs_at = #st_Brhs_At#, -->
	<!-- st_profsr_no = #st_Profsr_No#, -->
	<!-- st_grdtn_dt = #st_Grdtn_Dt# -->
	where st_stdnt_no = #st_Stdnt_No#
	</update>
	
	<update id="updateBrhs" parameterClass="stdnt">
	update stdnt set 
	st_brhs_at = #st_Brhs_At#
	where st_stdnt_no = #st_Stdnt_No#
	</update>
	
	<update id="updatePwStdnt" parameterClass="stdnt">
		update stdnt
		set st_Pw = #st_Pw#
		where st_Stdnt_No = #st_Stdnt_No#
	</update>
	
	<!-- 학과코드로 학과 내 학생 조회 -->
	<select id="subjctStdnt" parameterClass="str" resultClass="stdnt">
		select * from stdnt
		where st_subjct_code = #st_Subjct_Code#
	</select>
	
	<!-- 재학 중인 학생 조회 -->
	<select id="selectStdntList" parameterClass="stdnt" resultClass="stdnt">
		select * from stdnt
		where st_Stdnt_No like '%%'
		<isNull prepend="and" property="st_Grdtn_Dt">
		ST_GRDTN_DT is null
		</isNull>
		<isNotNull prepend="and" property="st_Brhs_At">
		st_Brhs_At is not null
		</isNotNull>
	</select>
	
	<!-- 재학 중인 학생 조회 개수 -->
	<select id="countStdntList" parameterClass="stdnt" resultClass="int">
		select count(*) from stdnt
		where st_Stdnt_No like '%%'
		<isNull prepend="and" property="st_Grdtn_Dt">
		ST_GRDTN_DT is null
		</isNull> 
		<isNotNull prepend="and" property="st_Brhs_At">
		st_Brhs_At is not null
		</isNotNull>
	</select>
	
	<!-- 학생조회 -->
	<select id="selectAllStdntList2" parameterClass="stdnt" resultClass="stdnt">
		select * from stdnt_view
		where st_Stdnt_No like '%$st_Stdnt_No$%'
		and st_Nm like '%$st_Nm$%'
		and sit_Subjct like '%$sit_Subjct$%'
		<isNull prepend="and" property="st_Grdtn_Dt">
		ST_GRDTN_DT is null
		</isNull> 
		<isNotNull prepend="and" property="st_Brhs_At">
		st_Brhs_At is not null
		</isNotNull>
	</select>
	
	<!-- 학생 개수 조회 -->
	<select id="countStdntList2" parameterClass="stdnt" resultClass="int">
		select count(*) from stdnt_view
		where st_Stdnt_No like '%$st_Stdnt_No$%'
		and st_Nm like '%$st_Nm$%'
		and sit_Subjct like '%$sit_Subjct$%'
		<isNull prepend="and" property="st_Grdtn_Dt">
		ST_GRDTN_DT is null
		</isNull> 
		<isNotNull prepend="and" property="st_Brhs_At">
		st_Brhs_At is not null
		</isNotNull>
	</select>
	
	<update id="updateSt_Profsr_No" parameterClass="stdnt">
		update stdnt
		set st_Profsr_No = #st_Profsr_No#
		where st_Stdnt_No = #st_Stdnt_No#
	</update>
</sqlMap>
