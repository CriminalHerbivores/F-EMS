<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Tuition">
	<typeAlias alias="str" type="java.lang.String" />
	<typeAlias alias="int" type="java.lang.Integer" />
	<typeAlias alias = "search" type="com.uni.fems.dto.SearchVO" />
	<typeAlias alias = "tuition" type="com.uni.fems.dto.TuitionVO" />
	
	<!-- 학과 등록금 수정은 학과xml을 참고 -->
	
	<!-- 등록금 고지 -->
	<update id="insertTuition" parameterClass="tuition">
		insert into tuition(
			tu_no,
			tu_Tut,
			tu_Stdnt_No
		)values(
			tu_seq.nextval,
			#tu_Tut#,
			#tu_Stdnt_No#
		)
	</update>
	
	<!-- 등록금 납부일 등록 -->
	<update id="updateTuition" parameterClass="tuition">
		update tuition
		set tu_Pay_Dt = $tu_Pay_Dt$
		where tu_No=#tu_No#
	</update>
	
	<!-- 학생의 등록금 조회 -->
	<select id="tuitionStdnt" parameterClass="tuition" resultClass="tuition">
		select 
			s.*, j.*, t.*, f.*, c.*,
			(tu_Dt+7) as tu_Dt_L
		from tuition t, SUBJCT_INFO_TABLE j, stdnt s, faculty f, colege c
		where s.st_subjct_code = j.sit_subjct_code
    	and t.TU_STDNT_NO = s.st_stdnt_no
    	and c.coleg_code =  f.FC_COLEG_CODE
      	and f.FC_FACULTY_CODE = j.SIT_FACULTY
		and tu_Stdnt_No like '%'||#tu_Stdnt_No#||'%'
		<isNotNull property="tu_Dt" prepend="and">
		to_date(#tu_Dt#) > tu_dt 
  		</isNotNull>
		<isNotNull property="tu_Dt" prepend="and">
  		tu_dt+7 > to_date(#tu_Dt#)
  		</isNotNull>
		and $key$ like '%'||#value#||'%'
		order by tu_no desc
	</select>
	<!-- 학생의 등록금 조회 개수 -->
	<select id="counttuitionStdnt" parameterClass="tuition" resultClass="int">
		select 
			count(*)
		from tuition t, SUBJCT_INFO_TABLE j, stdnt s
		where s.st_subjct_code = j.sit_subjct_code
    	and t.TU_STDNT_NO = s.st_stdnt_no
		and tu_Stdnt_No like '%'||#tu_Stdnt_No#||'%'
		<isNotNull property="tu_Dt" prepend="and">
		to_date(#tu_Dt#) > tu_dt 
  		</isNotNull>
		<isNotNull property="tu_Dt" prepend="and">
  		tu_dt+7 > to_date(#tu_Dt#)
  		</isNotNull>
		and $key$ like '%'||#value#||'%'
		order by tu_no desc
	</select>
	
	<!-- 미납 등록금 조회 -->
	<select id="selectNotTuition" parameterClass="tuition" resultClass="tuition">
		select * from tuition
		where tu_Pay_Dt is null
		and $key$ like '%'||#value#||'%'
		order by tu_no desc
	</select>
	
</sqlMap>