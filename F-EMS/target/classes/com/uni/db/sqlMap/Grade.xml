<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Grade">
	<typeAlias alias="str" type="java.lang.String" />
	<typeAlias alias="int" type="java.lang.Integer" />
	<typeAlias alias="grade" type="com.uni.fems.dto.GradeVO" />
	<typeAlias alias="reqst" type="com.uni.fems.dto.ReqstVO" />
	
	<update id="insertGrade" parameterClass="reqst">
		insert into GRADE(
			GD_STDNT_NO,
			GD_LCTRE_NO
		) values (
			#re_Stdnt_No#,
			#re_Lctre_No#
		)
	</update>
	<update id="updateGrade" parameterClass="grade">
		update GRADE
		set
			gd_Grade=#gd_Grade#,
			gd_Tot_Score=#gd_Tot_Score#,
			gd_Attd_Score=#gd_Attd_Score#,
			gd_Atend_Score=#gd_Atend_Score#,
			gd_Task_Score=#gd_Task_Score#,
			gd_Midex_Score=#gd_Midex_Score#,
			gd_Fnex_Score=#gd_Fnex_Score#,
			gd_Mini_Score=#gd_Mini_Score#
		where gd_Stdnt_No = #gd_Stdnt_No#
		and gd_Lctre_No = #gd_Lctre_No#
	</update>
	
	<update id="deleteGrade" parameterClass="reqst">
		delete from GRADE
		where gd_Stdnt_No = #re_Stdnt_No#
		and gd_Lctre_No = #re_Lctre_No#
	</update>
	
	<select id="selectGrade" parameterClass="grade" resultClass="grade">
		select * from grade
		where gd_Stdnt_No like '%'||#gd_Stdnt_No#||'%'
		and gd_Lctre_No like '%'||#gd_Lctre_No#||'%'
	</select>
	<select id="countGrade" parameterClass="grade" resultClass="int">
		select count(*) from grade
		where gd_Stdnt_No like '%'||#gd_Stdnt_No#||'%'
		and gd_Lctre_No like '%'||#gd_Lctre_No#||'%'
	</select>
	
	<select id="lctreGrade" parameterClass="grade" resultClass="grade">
		select g.*,l.*, extract(year from(lc_lctrbgn_dt)) as lc_year,
		case when ROUND(g.GD_GRADE,2) >=4.25 then 'A+'
		     when ROUND(g.GD_GRADE,2) >=3.75 then 'A'
		     when ROUND(g.GD_GRADE,2) >=3.25 then 'B+'
		     when ROUND(g.GD_GRADE,2) >=2.75 then 'B'
		     when ROUND(g.GD_GRADE,2) >=2.25 then 'C+'
		     when ROUND(g.GD_GRADE,2) >=1.75 then 'C'
		     when ROUND(g.GD_GRADE,2) >=1.25 then 'D+'
		     when ROUND(g.GD_GRADE,2) >=0.75 then 'D'
		     else 'F'
		end as gd_al
		from grade g, lctre_view l
		where g.GD_LCTRE_NO = l.lc_lctre_no
		and g.gd_stdnt_no = #gd_Stdnt_No#
	</select>
</sqlMap>